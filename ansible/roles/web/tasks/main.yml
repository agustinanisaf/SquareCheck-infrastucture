---
# This playbook contains web plays that will run docker-compose.

- name: Copy .env for docker-compose
  copy:
    src: .env
    dest: /home/deploy/square_check/docker/.env

- name: Add traefik.toml config file
  template:
    src: traefik.toml.j2
    dest: /home/deploy/square_check/docker/traefik.toml

- name: Add traefik_dynamic.toml config file
  template:
    src: traefik_dynamic.toml.j2
    dest: /home/deploy/square_check/docker/traefik_dynamic.toml

- name: Add acme.json config file
  copy:
    src: acme.json
    dest: /home/deploy/square_check/docker/acme.json
    owner: deploy
    group: deploy
    mode: '0600'

- name: Run Docker-Compose
  shell: docker-compose -f docker-compose.prod.yml up -d
  args:
    chdir: /home/deploy/square_check/docker
